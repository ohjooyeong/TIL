# CORSë€ ë¬´ì—‡ì¸ê°€ìš”?

ë„ë©”ì¸ ë˜ëŠ” í¬íŠ¸ê°€ ë‹¤ë¥¸ ì„œë²„ì˜ ìì›ì„ ìš”ì²­í•˜ëŠ” ë©”ì»¤ë‹ˆì¦˜

**êµì°¨ ì¶œì²˜ ë¦¬ì†ŒìŠ¤ ê³µìœ (Cross-Origin Resource Sharing, CORS)**ëŠ” ì¶”ê°€ HTTP í—¤ë”ë¥¼ ì‚¬ìš©í•˜ì—¬, í•œ ì¶œì²˜ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë‹¤ë¥¸ ì¶œì²˜ì˜ ì„ íƒí•œ ìì›ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì„ ë¶€ì—¬í•˜ë„ë¡ ë¸Œë¼ìš°ì €ì— ì•Œë ¤ì£¼ëŠ” ì²´ì œ

> ğŸ‘‰ğŸ» CORS ì²´ì œëŠ” ë¸Œë¼ìš°ì €ì™€ ì„œë²„ ê°„ì˜ ì•ˆì „í•œ êµì°¨ ì¶œì²˜ ìš”ì²­ ë° ë°ì´í„° ì „ì†¡ì„ ì§€ì›í•œë‹¤.
> ìµœì‹  ë¸Œë¼ìš°ì €ëŠ” XMLHttpRequest ë˜ëŠ” Fetchì™€ ê°™ì€ APIì—ì„œ CORSë¥¼ ì‚¬ìš©í•˜ì—¬ êµì°¨ ì¶œì²˜ HTTP ìš”ì²­ì˜ ìœ„í—˜ì„ ì™„í™” í•œë‹¤.

-   ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ë¦¬ì†ŒìŠ¤ê°€ ìì‹ ì˜ ì¶œì²˜(ë„ë©”ì¸, í”„ë¡œí† ì½œ, í¬íŠ¸)ì™€ ë‹¤ë¥¼ ë•Œ êµì°¨ ì¶œì²˜ HTTP ìš”ì²­ì„ ì‹¤í–‰í•œë‹¤

-   â­ ë¸Œë¼ìš°ì €ëŠ” ë³´ì•ˆ ìƒì˜ ì´ìœ ë¡œ, ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì‹œì‘í•œ êµì°¨ ì¶œì²˜ HTTP ìš”ì²­ì„ ì œí•œí•œë‹¤.
    ex) domain-a.com â†”domain-b.com ê°„ì˜ ìš”ì²­ì€ CORS ì •ì±… ìœ„ë°˜ìœ¼ë¡œ, ë¸Œë¼ìš°ì €ì—ì„œ ìš”ì²­ì„ ì œí•œ)

-   ë”°ë¼ì„œ ë‹¤ë¥¸ ì¶œì²˜ì˜ ë¦¬ì†ŒìŠ¤ë¥¼ ë¶ˆëŸ¬ì˜¤ê¸° ìœ„í•´ì„œëŠ”, ê·¸ ì¶œì²˜ì—ì„œ êµì°¨ ì¶œì²˜ ë¦¬ì†ŒìŠ¤ ê³µìœ ì— ëŒ€í•œ í—¤ë”(CORS)ë¥¼ ì‘ë‹µì‹œ ë°˜í™˜ í•´ì£¼ì–´ì•¼ í•œë‹¤

## CORSëŠ” ì–´ë–»ê²Œ ë™ì‘í•˜ë‚˜ìš”?

1. ê¸°ë³¸ì ìœ¼ë¡œ ì›¹ì€ ë‹¤ë¥¸ ì¶œì²˜ì˜ ë¦¬ì†ŒìŠ¤ë¥¼ ìš”ì²­í•  ë•ŒëŠ” HTTP í”„ë¡œí† ì½œì„ ì‚¬ìš©í•˜ì—¬ ìš”ì²­ì„ í•˜ëŠ”ë°, ì´ë•Œ ë¸Œë¼ìš°ì €ëŠ” ìš”ì²­ í—¤ë”(request header)ì— Origin í•„ë“œì— ìš”ì²­ì„ ë³´ë‚´ëŠ” ì¶œì²˜ë¥¼ ë‹´ì•„ ì „ì†¡í•œë‹¤.
2. ì„œë²„ëŠ” ìš”ì²­ì— ëŒ€í•œ ì‘ë‹µì„ í•˜ëŠ”ë°, ì‘ë‹µ í—¤ë”(response header)ì— Access-control-Allow-Origin ì´ë¼ëŠ” ê°’ì— 'ì´ ë¦¬ì†ŒìŠ¤ë¥¼ ì ‘ê·¼í•˜ëŠ” ê²ƒì´ í—ˆìš©ëœ ì¶œì²˜'ë¥¼ ë‚´ë ¤ì¤€ë‹¤. ì´í›„ ì‘ë‹µì„ ë°›ì€ ë¸Œë¼ìš°ì €ëŠ” ìì‹ ì´ ë³´ëƒˆë˜ ìš”ì²­ì˜ Originê³¼ ì„œë²„ê°€ ë³´ë‚´ì¤€ ì‘ë‹µì˜ Access-Control-Allow-Originì„ ë¹„êµí•´ë³¸ í›„ ì´ ì‘ë‹µì´ ìœ íš¨í•œ ì‘ë‹µì¸ì§€ ì•„ë‹Œì§€ë¥¼ ê²°ì •í•œë‹¤

> ì´ê²ƒì´ ê¸°ë³¸ì ì¸ CORS ë™ì‘ì˜ íë¦„ì´ë‹¤. í•˜ì§€ë§Œ ëª¨ë“  CORS ë™ì‘ì˜ ë°©ì‹ì€ ì•„ë‹ˆë‹¤.

## CORS ë™ì‘ì˜ ì‹œë‚˜ë¦¬ì˜¤

### 1. Preflight Request

Preflight ë°©ì‹ì€, ìš”ì²­ì„ í•œë²ˆì— ë³´ë‚´ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ì˜ˆë¹„ ìš”ì²­ê³¼ ë³¸ ìš”ì²­ìœ¼ë¡œ ë‚˜ëˆ„ì–´ì„œ ì„œë²„ë¡œ ì „ì†¡í•œë‹¤.

ë³¸ ìš”ì²­ì„ ë³´ë‚´ê¸° ì „ ë¯¸ë¦¬ ì˜ˆë¹„ë¡œ ë³´ë‚´ëŠ” ìš”ì²­ì„ Preflightë¼ê³  í•˜ë©°, HTTP ë©”ì„œë“œ ì¤‘ í•˜ë‚˜ì¸ OPTIONS ë©”ì„œë“œë¥¼ ì‚¬ìš©í•œë‹¤.

> WHY?
> ì˜ˆë¹„ ìš”ì²­ì„ í•¨ìœ¼ë¡œì¨ ë³¸ ìš”ì²­ì„ ë³´ë‚´ê¸° ì „ ë¸Œë¼ìš°ì € ìŠ¤ìŠ¤ë¡œê°€ ìš”ì²­ì„ ë³´ë‚´ëŠ” ê²ƒì— ëŒ€í•œ ì•ˆì „ì„±ì„ í™•ì¸í•¨ì— ìˆë‹¤.
> ì„œë²„ëŠ” ì´ ì˜ˆë¹„ ìš”ì²­ì— ëŒ€í•œ ì‘ë‹µìœ¼ë¡œ í˜„ì¬ ìì‹ ì´ ì–´ë–¤ ê²ƒë“¤ì„ í—ˆìš© í•˜ê³ , ì–´ë–¤ ê²ƒë“¤ì„ ê¸ˆì§€í•˜ê³  ìˆëŠ”ì§€ì— ëŒ€í•œ ì •ë³´ë¥¼ ì‘ë‹µ í—¤ë”ì— ë‹´ì•„ì„œ ë¸Œë¼ìš°ì €ì—ê²Œ ë‹¤ì‹œ ë³´ë‚´ì¤€ë‹¤.

ë‹¨ìˆœíˆ Originì— ëŒ€í•œ ì •ë³´ ë¿ë§Œ ì•„ë‹ˆë¼ ìì‹ ì´ ì˜ˆë¹„ ìš”ì²­ ì´í›„ì— ë³´ë‚¼ ë³¸ ìš”ì²­ì— ëŒ€í•œ ë‹¤ë¥¸ ì •ë³´ë“¤ë„ í•¨ê»˜ ì „ì†¡ í•œë‹¤. ì–´ë–¤ í—¤ë”ë¥¼ í¬í•¨ í•  ê²ƒì¸ì§€, ì–´ë–¤ HTTP ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ìš”ì²­ì„ ë³´ë‚¼ ê²ƒì¸ì§€ ë§ì´ë‹¤.

### 2. Simple Request

Preflight ìš”ì²­ê³¼ëŠ” ë‹¬ë¦¬, ì˜ˆë¹„ ìš”ì²­ì„ ë³´ë‚´ì§€ ì•Šê³ , ì„œë²„ì—ê²Œ ë°”ë¡œ ë³¸ ìš”ì²­ì„ ì „ì†¡í•œë‹¤.

ì´ í›„ ì„œë²„ê°€ ì‘ë‹µ í—¤ë”ì— Access-Control-Allow-Originê³¼ ê°™ì€ ê°’ì„ ë³´ë‚´ì£¼ë©´ ê·¸ë•Œ ë¸Œë¼ìš°ì €ê°€ CORS ì •ì±… ìœ„ë°˜ ì—¬ë¶€ë¥¼ ê²€ì‚¬í•˜ëŠ” ë°©ì‹ì´ë‹¤.

#### ë™ì‘ ì¡°ê±´

1. ìš”ì²­ì˜ ë©”ì„œë“œëŠ” GET, HEAD, POST ì¤‘ í•˜ë‚˜ì—¬ì•¼ í•œë‹¤.
2. Accept, Accept-Language, Content-Language, Content-Type, DPR, Downlink, Save-Data, Viewport-Width, Width ì™¸ì˜ ë‹¤ë¥¸ í—¤ë”ë¥¼ ì‚¬ìš©í•˜ë©´ ì•ˆëœë‹¤.
3. ë§Œì•½ Content-Typeë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ì—ëŠ” application/x-www-form-urlencoded, multipart/form-data, text/plainë§Œ í—ˆìš©ëœë‹¤.

### 3. Credentialed Request

Credentialed Request.
ì¸ì¦ëœ ìš”ì²­ì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì´ë‹¤.

ë‹¤ë¥¸ ì¶œì²˜ ê°„ í†µì‹ ì˜ ì¢€ ë” ë³´ì•ˆì„ ê°•í™”í•˜ê³ ì í•  ë•Œ ì‚¬ìš©í•œë‹¤. ë¸Œë¼ìš°ì €ê°€ ì œê³µí•˜ëŠ” ë¹„ë™ê¸° ë¦¬ì†ŒìŠ¤ ìš”ì²­ APIì¸ XMLHttpRequest ê°ì²´ë‚˜ fetch APIëŠ” ë³„ë„ì˜ ì˜µì…˜ ì—†ì´ ë¸Œë¼ìš°ì €ì˜ ì¿ í‚¤ ì •ë³´ë‚˜ ì¸ì¦ê³¼ ê´€ë ¨ëœ í—¤ë”ë¥¼ í•¨ë¶€ë¡œ ìš”ì²­ì— ë‹´ì§€ ì•ŠëŠ”ë‹¤. ì´ë•Œ ìš”ì²­ì— ì¸ì¦ê³¼ ê´€ë ¨ëœ ì •ë³´ë¥¼ ë‹´ì„ ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ì˜µì…˜ì´ ë°”ë¡œ credentials ì˜µì…˜ì´ë‹¤.

credentialsë„ ì„¸ê°€ì§€ ì˜µì…˜ì„ ê°€ì§€ê³  ìˆë‹¤.

-   same-origin : ê°™ì€ ì¶œì²˜ ê°„ ìš”ì²­ì—ë§Œ ì¸ì¦ ì •ë³´ë¥¼ ë‹´ì„ ìˆ˜ ìˆë‹¤.
-   include : ëª¨ë“  ìš”ì²­ì— ì¸ì¦ ì •ë³´ë¥¼ ë‹´ì„ ìˆ˜ ìˆë‹¤.
-   omit - : ëª¨ë“  ìš”ì²­ì— ì¸ì¦ ì •ë³´ë¥¼ ë‹´ì§€ ì•ŠëŠ”ë‹¤.

    > ğŸ‘‰ğŸ» ë‹¤ë¥¸ ì¶œì²˜ ì‚¬ì´íŠ¸ë¡œì˜ ìš”ì²­ì— ì¿ í‚¤ì™€ ê°™ì€ ì¸ì¦ì •ë³´ë¥¼ í¬í•¨ì‹œí‚¤ê³ ì í•œë‹¤ë©´ ?
    > â†’ credentials: 'include' ì˜µì…˜ì„ ì¶”ê°€

ë™ì‘ ì¡°ê±´

1. Access-Control-Allow-Origin: \* ì´ë©´ ì•ˆë˜ë©°, ëª…ì‹œì ì¸ URLì„ ì„¤ì •í•˜ì—¬í– í•œë‹¤.
   ex) Access-Control-Allow-Origin: https://xxx.com
2. ì‘ë‹µ í—¤ë”ì—ëŠ” ë°˜ë“œì‹œ Access-Control-Allow-Credentials: trueê°€ ì¡´ì¬í•´ì•¼í•œë‹¤.

-   ì¶œì²˜ https://evan-moon.github.io/2020/05/21/about-cors/#credentialed-request
